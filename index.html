<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Action Journal</title>
  <style>
    :root {
      --primary: #2d5a6b;
      --secondary: #4a8296;
      --paper: #f5f5f5;
      --bg: #e4e9ed;
      --text: #333;
      --border-color: #ccc;
    }
    [data-theme="dark"] {
      --primary: #88c0d0;
      --secondary: #5e81ac;
      --paper: #2e3440;
      --bg: #21252b;
      --text: #d8dee9;
      --border-color: #4c566a;
    }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; min-height: 100vh; transition: background 0.3s, color 0.3s; }
    .journal-page { width: 100%; max-width: 600px; background: var(--paper); padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 20px; }
    .date-header { text-align: center; font-family: 'Courier New', monospace; font-size: 1.2em; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin: 0 0 10px 0; }
    
    h2 { font-size: 1.3em; margin: 0; padding-bottom: 5px; border-bottom: 2px solid var(--primary); color: var(--primary); }
    textarea {
      width: 100%;
      font-size: 1.1em;
      line-height: 1.6;
      font-family: inherit;
      border: 1px solid transparent;
      background: transparent;
      resize: none;
      outline: none;
      color: var(--text);
      padding: 0;
      min-height: 90px;
      overflow-y: hidden;
    }
    textarea:focus { border-color: transparent; }

    .page-number { font-size: 0.9em; text-align: right; color: #888; margin-top: 10px; }
    .controls { margin-top: 20px; display: flex; gap: 16px; justify-content: center; }
    button { background: var(--primary); color: white; border: none; padding: 10px 20px; font-size: 1em; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
    button:hover:not(:disabled) { background: var(--secondary); }
    button:disabled { background: #a99484; cursor: not-allowed; }
    .theme-toggle { position: fixed; top: 10px; right: 10px; font-size: 0.9em; z-index: 10; }

    /* Compact Trackers */
    .trackers { display: flex; justify-content: space-around; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px; }
    [data-theme="dark"] .trackers { background: rgba(255,255,255,0.05); }
    .tracker-group { display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .tracker-group label { font-weight: bold; font-size: 0.9em; }
    .tracker-group select, .tracker-group input { font-size: 0.9em; }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">üåô</button>
  <div class="journal-page">
    <h1 class="date-header" id="dateHeader">Loading...</h1>
    
    <div>
      <h2>‚òÄÔ∏è Morning Plan</h2>
      <textarea id="morningPlan" placeholder="üéØ Today's #1 Goal: ...
üóìÔ∏è Key Tasks: ...
üôè Intention: ..."></textarea>
    </div>

    <div class="trackers">
      <div class="tracker-group">
        <label for="mood">Mood</label>
        <select id="mood"><option value="">Select</option><option>‚ö°Ô∏è High Energy</option><option>üòä Good</option><option>üòê Okay</option><option>üìâ Low Energy</option></select>
      </div>
      <div class="tracker-group">
        <label>Habits</label>
        <div>
          <input type="checkbox" id="habit1" title="Habit 1"><input type="checkbox" id="habit2" title="Habit 2"><input type="checkbox" id="habit3" title="Habit 3">
        </div>
      </div>
    </div>
    
    <div>
      <h2>üåô Evening Review</h2>
      <textarea id="eveningReview" placeholder="‚úÖ Outcome & Lesson Learned: ..."></textarea>
    </div>
    
    <div class="page-number" id="pageNumber"></div>
  </div>
  <div class="controls">
    <button id="prevBtn">‚Äπ Prev</button>
    <button id="nextBtn">Next ‚Ä∫</button>
  </div>
  <div class="controls">
    <button id="downloadBackup">‚¨áÔ∏è Backup</button>
    <input type="file" id="uploadBackup" accept=".json" style="display:none;">
    <button id="loadBackup">‚¨ÜÔ∏è Load Backup</button>
  </div>

<script>
const app = {
  YEAR: 2025,
  TOTAL_DAYS: 365,
  currentDay: 1,
  dom: {},
  config: {},
  
  init() {
    this.TOTAL_DAYS = ((this.YEAR % 4 === 0 && this.YEAR % 100 !== 0) || (this.YEAR % 400 === 0)) ? 366 : 365;
    this.cacheDom();
    this.initConfig();
    this.bindEvents();
    this.loadInitialPage();
    this.loadTheme();
  },
  
  cacheDom() {
    this.dom.dateHeader = document.getElementById('dateHeader');
    this.dom.pageNumber = document.getElementById('pageNumber');
    this.dom.prevBtn = document.getElementById('prevBtn');
    this.dom.nextBtn = document.getElementById('nextBtn');
    this.dom.themeToggle = document.getElementById('themeToggle');
    this.dom.downloadBtn = document.getElementById('downloadBackup');
    this.dom.uploadBtn = document.getElementById('uploadBackup');
    this.dom.loadBtn = document.getElementById('loadBackup');
  },
  
  initConfig() {
      this.config = {
          morningPlan:   { type: 'value', el: document.getElementById('morningPlan') },
          eveningReview: { type: 'value', el: document.getElementById('eveningReview') },
          mood:          { type: 'value', el: document.getElementById('mood') },
          habit1:        { type: 'checked', el: document.getElementById('habit1') },
          habit2:        { type: 'checked', el: document.getElementById('habit2') },
          habit3:        { type: 'checked', el: document.getElementById('habit3') },
      };
  },
  
  bindEvents() {
    this.dom.prevBtn.addEventListener('click', () => this.navigate(-1));
    this.dom.nextBtn.addEventListener('click', () => this.navigate(1));
    this.dom.themeToggle.addEventListener('click', () => this.toggleTheme());
    this.dom.downloadBtn.addEventListener('click', () => this.downloadBackup());
    this.dom.loadBtn.addEventListener('click', () => this.dom.uploadBtn.click());
    this.dom.uploadBtn.addEventListener('change', (e) => this.loadBackup(e));
    
    Object.values(this.config).forEach(field => {
        field.el.addEventListener('input', () => this.saveState());
    });
    document.querySelectorAll('textarea').forEach(el => {
        el.addEventListener('input', () => this.autoGrow(el));
    });
  },
  
  getStorageKey(day, key) { return `journal-v2-${this.YEAR}-day-${day}-${key}`; },
  
  saveState() {
    try {
      for (const [key, field] of Object.entries(this.config)) {
        localStorage.setItem(this.getStorageKey(this.currentDay, key), field.el[field.type]);
      }
      localStorage.setItem('journal-v2-last-opened', this.currentDay);
    } catch (e) {
      console.error("Failed to save state.", e);
    }
  },
  
  loadState() {
    for (const [key, field] of Object.entries(this.config)) {
      const value = localStorage.getItem(this.getStorageKey(this.currentDay, key));
      if (value !== null) {
        field.el[field.type] = field.type === 'checked' ? value === 'true' : value;
      } else {
        field.el[field.type] = field.type === 'checked' ? false : '';
      }
    }
  },
  
  updatePage() {
    const date = new Date(this.YEAR, 0, this.currentDay);
    this.dom.dateHeader.textContent = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    this.dom.pageNumber.textContent = `Day ${this.currentDay}`;
    this.loadState();
    document.querySelectorAll('textarea').forEach(this.autoGrow);
    this.dom.prevBtn.disabled = this.currentDay <= 1;
    this.dom.nextBtn.disabled = this.currentDay >= this.TOTAL_DAYS;
  },
  
  navigate(direction) {
    this.saveState();
    const newDay = this.currentDay + direction;
    if (newDay >= 1 && newDay <= this.TOTAL_DAYS) {
      this.currentDay = newDay;
      this.updatePage();
    }
  },
  
  loadInitialPage() {
    const saved = parseInt(localStorage.getItem('journal-v2-last-opened'), 10);
    const today = new Date();
    const start = new Date(this.YEAR, 0, 1);
    const dayOfYear = Math.floor((today - start) / (1000 * 60 * 60 * 24)) + 1;
    this.currentDay = !isNaN(saved) ? saved : (today.getFullYear() === this.YEAR ? dayOfYear : 1);
    this.updatePage();
  },

  autoGrow(element) {
    element.style.height = 'auto';
    element.style.height = (element.scrollHeight) + 'px';
  },
  
  toggleTheme() {
    const isDark = document.documentElement.hasAttribute('data-theme');
    if (isDark) {
      document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('journal-theme', 'light');
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      localStorage.setItem('journal-theme', 'dark');
    }
  },
  
  loadTheme() {
    if (localStorage.getItem('journal-theme') === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  },

  downloadBackup() { /* ... unchanged ... */ },
  loadBackup(e) { /* ... unchanged ... */ }
};
app.init();
</script>
</body>
</html>
