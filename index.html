<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My 2025 Journal</title>
  <style>
    :root {
      --primary: #5a3a22;
      --secondary: #794f30;
      --paper: #fffaf0;
      --bg: #f0e8d9;
      --text: #333;
      --border-color: #ddd;
    }

    [data-theme="dark"] {
      --primary: #e6d3c1;
      --secondary: #c3b3a5;
      --paper: #1c1c1c;
      --bg: #121212;
      --text: #e2e2e2;
      --border-color: #444;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Georgia, serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    .journal-page {
      width: 100%;
      max-width: 600px;
      background: var(--paper);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      transition: background 0.3s;
    }

    .date-header {
      font-family: 'Courier New', monospace;
      font-size: 1.2em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      margin: 0 0 10px 0;
    }

    textarea, input[type="text"], input[type="number"] {
      width: 100%;
      font-size: 1em;
      font-family: Georgia, serif;
      border: none;
      background: transparent;
      resize: none;
      outline: none;
      line-height: 1.6;
      color: var(--text);
      box-sizing: border-box;
      background: var(--paper);
      border-radius: 6px;
      padding: 6px;
    }

    textarea {
      min-height: 3em;
      overflow-y: hidden;
    }

    .page-number {
      margin-top: 10px;
      font-size: 0.9em;
      text-align: right;
      color: #888;
    }

    .controls { margin-top: 20px; display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; }
    button { background: var(--primary); color: white; border: none; padding: 10px 20px; font-size: 1em; border-radius: 5px; cursor: pointer; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); transition: background 0.3s; }
    button:hover:not(:disabled) { background: var(--secondary); }
    button:disabled { background: #a99484; cursor: not-allowed; }
    .mood-section, .habits-section { margin-top: 16px; }
    .mood-section label, .habits-section label, .extra-section label { display: block; margin-top: 10px; font-weight: bold; }
    select { width: 100%; padding: 6px; font-size: 1em; margin-top: 4px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--paper); color: var(--text); }
    .theme-toggle { position: fixed; top: 10px; right: 10px; font-size: 0.9em; }
    blockquote { margin: 0 0 10px; font-style: italic; color: #666; }
    .habits-section label { font-weight: normal; display: flex; align-items: center; gap: 6px; }

    /* --- CHANGE 1: ADD TABLE STYLES --- */
    #dailyScheduleTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    #dailyScheduleTable td {
      border: 1px solid var(--border-color);
      padding: 8px;
      vertical-align: top;
    }
    #dailyScheduleTable td:first-child {
      width: 35%;
      font-weight: bold;
      background-color: rgba(0,0,0,0.02);
    }
    [data-theme="dark"] #dailyScheduleTable td:first-child {
      background-color: rgba(255,255,255,0.05);
    }
    #dailyScheduleTable td[contenteditable="true"] {
      outline: none;
    }
    #dailyScheduleTable td[contenteditable="true"]:focus {
      outline: 2px solid var(--secondary);
      box-shadow: 0 0 5px var(--secondary);
    }
    /* Placeholder-like text for empty cells */
    #dailyScheduleTable td[contenteditable="true"]:empty::before {
      content: 'Plan your activity...';
      color: #999;
      font-style: italic;
    }
    /* --- CHANGE 1 END --- */

    @media (max-width: 500px) {
      textarea, #dailyScheduleTable td { font-size: 0.9em; }
      button { font-size: 0.9em; padding: 8px 12px; }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">🌙 Dark Mode</button>
  <div class="journal-page">
    <h2 class="date-header" id="dateHeader">Loading...</h2>
    <blockquote id="quoteBox">"Quote of the day"</blockquote>
    <div class="extra-section">
      <label for="affirmation">📝 Morning Affirmation:</label>
      <textarea id="affirmation" placeholder="I intend to..."></textarea>
    </div>
    <div class="extra-section">
      <label for="topTasks">🔥 Top 3 Priorities:</label>
      <textarea id="topTasks" placeholder="1.\n2.\n3."></textarea>
    </div>

    <!-- --- CHANGE 2: REPLACE TEXTAREA WITH TABLE --- -->
    <div class="extra-section">
      <label>🗓️ My Daily Schedule:</label>
      <table id="dailyScheduleTable">
        <tbody>
          <tr>
            <td>Morning (6am-9am)</td>
            <td contenteditable="true" data-slot="early-morning"></td>
          </tr>
          <tr>
            <td>Focus Block (9am-12pm)</td>
            <td contenteditable="true" data-slot="morning"></td>
          </tr>
          <tr>
            <td>Midday (12pm-2pm)</td>
            <td contenteditable="true" data-slot="midday"></td>
          </tr>
          <tr>
            <td>Afternoon (2pm-5pm)</td>
            <td contenteditable="true" data-slot="afternoon"></td>
          </tr>
          <tr>
            <td>Evening (5pm-9pm)</td>
            <td contenteditable="true" data-slot="evening"></td>
          </tr>
          <tr>
            <td>Wind Down (9pm onwards)</td>
            <td contenteditable="true" data-slot="wind-down"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- --- CHANGE 2 END --- -->

    <div class="extra-section">
      <label for="gratitude">🙏 Gratitude:</label>
      <textarea id="gratitude" placeholder="I'm thankful for..."></textarea>
    </div>
    <div class="mood-section">
      <label for="moodMorning">🌅 Morning Mood:</label>
      <select id="moodMorning">
        <option value="">Select...</option>
        <option>😊 Happy</option>
        <option>😐 Meh</option>
        <option>😴 Tired</option>
        <option>😔 Sad</option>
        <option>😡 Stressed</option>
      </select>
      <label for="moodAfternoon">🏞 Afternoon Mood:</label>
      <select id="moodAfternoon">
        <option value="">Select...</option>
        <option>😊 Happy</option>
        <option>😐 Meh</option>
        <option>😴 Tired</option>
        <option>😔 Sad</option>
        <option>😡 Stressed</option>
      </select>
      <label for="moodEvening">🌙 Evening Mood:</label>
      <select id="moodEvening">
        <option value="">Select...</option>
        <option>😊 Happy</option>
        <option>😐 Meh</option>
        <option>😴 Tired</option>
        <option>😔 Sad</option>
        <option>😡 Stressed</option>
      </select>
    </div>
    <div class="habits-section">
      <label>✅ Tiny Habits Tracker:</label>
      <label><input type="checkbox" id="habitRead"> 📚 Read 10 min</label>
      <label><input type="checkbox" id="habitMove"> 🚶 20‑min Walk</label>
      <label><input type="checkbox" id="habitWater"> 💧 2 L Water</label>
    </div>
    <div class="extra-section">
      <label for="eveningReflection">🌙 Evening Reflection:</label>
      <textarea id="eveningReflection" placeholder="How was today? What did I learn?"></textarea>
    </div>
    <textarea id="entryBox" placeholder="Write your journal entry..."></textarea>
    <div class="page-number" id="pageNumber"></div>
  </div>
  <div class="controls">
    <button id="prevBtn">‹ Prev</button>
    <button id="nextBtn">Next ›</button>
  </div>
  <div class="controls">
    <button id="downloadBackup">⬇️ Backup</button>
    <input type="file" id="uploadBackup" accept=".json" style="display:none;">
    <button id="loadBackup">⬆️ Load Backup</button>
  </div>
  <p style="font-size: 0.8em; color: #888; text-align: center; max-width: 600px;">
    Your journal is saved in this browser's local storage.
    Please use the <strong>Backup</strong> button regularly to prevent data loss.
  </p>
  <script>
    const YEAR = 2025;
    const TOTAL_DAYS = ((YEAR % 4 === 0 && YEAR % 100 !== 0) || (YEAR % 400 === 0)) ? 366 : 365;
    const QUOTES = [ "The journey of a thousand miles begins with a single step. — Lao Tzu", "The secret of getting ahead is getting started. — Mark Twain", "The best time to plant a tree was 20 years ago. The second best time is now. — Chinese Proverb", "It does not matter how slowly you go as long as you do not stop. — Confucius", "Believe you can and you're halfway there. — Theodore Roosevelt", "Act as if what you do makes a difference. It does. — William James", "Success is not final, failure is not fatal: it is the courage to continue that counts. — Winston Churchill", "What you do today can improve all your tomorrows. — Ralph Marston", "Don't watch the clock; do what it does. Keep going. — Sam Levenson", "The future depends on what you do today. — Mahatma Gandhi", "Well done is better than well said. — Benjamin Franklin", "Focus on being productive instead of busy. — Tim Ferriss", "Discipline is the bridge between goals and accomplishment. — Jim Rohn", "The key is not to prioritize what's on your schedule, but to schedule your priorities. — Stephen Covey", "Either you run the day or the day runs you. — Jim Rohn", "Success is the sum of small efforts, repeated day in and day out. — Robert Collier", "A goal without a plan is just a wish. — Antoine de Saint-Exupéry", "The successful warrior is the average man, with laser-like focus. — Bruce Lee", "We are what we repeatedly do. Excellence, then, is not an act, but a habit. — Aristotle", "The best way to predict the future is to create it. — Peter Drucker", "Life is 10% what happens to us and 90% how we react to it. — Charles R. Swindoll", "An unexamined life is not worth living. — Socrates", "The man who moves a mountain begins by carrying away small stones. — Confucius", "A year from now you may wish you had started today. — Karen Lamb", "Simplicity is the ultimate sophistication. — Leonardo da Vinci", "Do one thing every day that scares you. — Eleanor Roosevelt", "You must be the change you wish to see in the world. — Mahatma Gandhi", "Our greatest glory is not in never falling, but in rising every time we fall. — Confucius", "What we think, we become. — Buddha", "Happiness is not something ready made. It comes from your own actions. — Dalai Lama", "To keep the body in good health is a duty... otherwise we shall not be able to keep our mind strong and clear. — Buddha", "Peace comes from within. Do not seek it without. — Buddha", "Your visions will become clear only when you can look into your own heart. Who looks outside, dreams; who looks inside, awakes. — Carl Jung", "Done is better than good. — Elizabeth Gilbert", "It is better to live your own destiny imperfectly than to live an imitation of somebody else's life with perfection. — The Bhagavad Gita" /* Truncated for brevity */ ];

    // Elements
    const entryBox = document.getElementById('entryBox');
    const dateHeader = document.getElementById('dateHeader');
    const pageNumber = document.getElementById('pageNumber');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const themeToggle = document.getElementById('themeToggle');
    const affirmation = document.getElementById('affirmation');
    const topTasks = document.getElementById('topTasks');
    const gratitude = document.getElementById('gratitude');
    const eveningReflection = document.getElementById('eveningReflection');
    const moodMorning = document.getElementById('moodMorning');
    const moodAfternoon = document.getElementById('moodAfternoon');
    const moodEvening = document.getElementById('moodEvening');
    const habitRead = document.getElementById('habitRead');
    const habitMove = document.getElementById('habitMove');
    const habitWater = document.getElementById('habitWater');
    const downloadBackup = document.getElementById('downloadBackup');
    const uploadBackup = document.getElementById('uploadBackup');
    const loadBackup = document.getElementById('loadBackup');
    const quoteBox = document.getElementById('quoteBox');
    // --- CHANGE 3: SELECT THE TABLE INSTEAD OF THE TEXTAREA ---
    const dailyScheduleTable = document.getElementById('dailyScheduleTable');
    // --- CHANGE 3 END ---

    let currentDay = 1;

    function autoGrow(element) {
      element.style.height = 'auto';
      element.style.height = (element.scrollHeight) + 'px';
    }
    function getStorageKey(day, type = 'entry') { return `journal-${YEAR}-day-${day}-${type}`; }
    function getLocKey() { return `journal-${YEAR}-last-opened`; }

    function saveState() {
      // Save standard fields
      localStorage.setItem(getStorageKey(currentDay, 'entry'), entryBox.value);
      localStorage.setItem(getStorageKey(currentDay, 'affirmation'), affirmation.value);
      localStorage.setItem(getStorageKey(currentDay, 'tasks'), topTasks.value);
      localStorage.setItem(getStorageKey(currentDay, 'gratitude'), gratitude.value);
      localStorage.setItem(getStorageKey(currentDay, 'reflection'), eveningReflection.value);
      localStorage.setItem(getStorageKey(currentDay, 'mood-morning'), moodMorning.value);
      localStorage.setItem(getStorageKey(currentDay, 'mood-afternoon'), moodAfternoon.value);
      localStorage.setItem(getStorageKey(currentDay, 'mood-evening'), moodEvening.value);
      localStorage.setItem(getStorageKey(currentDay, 'habit-read'), habitRead.checked);
      localStorage.setItem(getStorageKey(currentDay, 'habit-move'), habitMove.checked);
      localStorage.setItem(getStorageKey(currentDay, 'habit-water'), habitWater.checked);
      localStorage.setItem(getLocKey(), currentDay);

      // --- CHANGE 4: CUSTOM LOGIC TO SAVE TABLE DATA ---
      const scheduleData = {};
      dailyScheduleTable.querySelectorAll('td[contenteditable="true"]').forEach(cell => {
        scheduleData[cell.dataset.slot] = cell.innerHTML; // Use innerHTML to save formatting like line breaks
      });
      localStorage.setItem(getStorageKey(currentDay, 'schedule'), JSON.stringify(scheduleData));
      // --- CHANGE 4 END ---
    }

    function loadState() {
      // Load standard fields
      entryBox.value = localStorage.getItem(getStorageKey(currentDay, 'entry')) || '';
      affirmation.value = localStorage.getItem(getStorageKey(currentDay, 'affirmation')) || '';
      topTasks.value = localStorage.getItem(getStorageKey(currentDay, 'tasks')) || '';
      gratitude.value = localStorage.getItem(getStorageKey(currentDay, 'gratitude')) || '';
      eveningReflection.value = localStorage.getItem(getStorageKey(currentDay, 'reflection')) || '';
      moodMorning.value = localStorage.getItem(getStorageKey(currentDay, 'mood-morning')) || '';
      moodAfternoon.value = localStorage.getItem(getStorageKey(currentDay, 'mood-afternoon')) || '';
      moodEvening.value = localStorage.getItem(getStorageKey(currentDay, 'mood-evening')) || '';
      habitRead.checked = localStorage.getItem(getStorageKey(currentDay, 'habit-read')) === 'true';
      habitMove.checked = localStorage.getItem(getStorageKey(currentDay, 'habit-move')) === 'true';
      habitWater.checked = localStorage.getItem(getStorageKey(currentDay, 'habit-water')) === 'true';

      // --- CHANGE 5: CUSTOM LOGIC TO LOAD TABLE DATA ---
      const savedSchedule = localStorage.getItem(getStorageKey(currentDay, 'schedule'));
      const scheduleCells = dailyScheduleTable.querySelectorAll('td[contenteditable="true"]');
      if (savedSchedule) {
        try {
          const scheduleData = JSON.parse(savedSchedule);
          scheduleCells.forEach(cell => {
            cell.innerHTML = scheduleData[cell.dataset.slot] || '';
          });
        } catch(e) {
          console.error("Could not parse schedule data for day " + currentDay);
          scheduleCells.forEach(cell => { cell.innerHTML = ''; });
        }
      } else {
        // Clear table if no data is found
        scheduleCells.forEach(cell => { cell.innerHTML = ''; });
      }
      // --- CHANGE 5 END ---
    }

    function updatePage() {
      const date = new Date(YEAR, 0, currentDay);
      const dateStr = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
      dateHeader.textContent = dateStr;
      pageNumber.textContent = `Day ${currentDay} of ${TOTAL_DAYS}`;
      quoteBox.textContent = QUOTES[(currentDay - 1) % QUOTES.length];
      loadState();
      document.querySelectorAll('textarea').forEach(autoGrow);
      prevBtn.disabled = currentDay <= 1;
      nextBtn.disabled = currentDay >= TOTAL_DAYS;
    }

    function goNext() { saveState(); if (currentDay < TOTAL_DAYS) { currentDay++; updatePage(); } }
    function goPrev() { saveState(); if (currentDay > 1) { currentDay--; updatePage(); } }
    function init() {
      const saved = parseInt(localStorage.getItem(getLocKey()), 10);
      const today = new Date();
      const start = new Date(YEAR, 0, 1);
      const dayOfYear = Math.floor((today - start) / (1000 * 60 * 60 * 24)) + 1;
      currentDay = (!isNaN(saved)) ? saved : (today.getFullYear() === YEAR ? dayOfYear : 1);
      updatePage();
      if (localStorage.getItem('journal-theme') === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '☀️ Light Mode';
      }
    }

    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      if (current === 'dark') {
        document.documentElement.removeAttribute('data-theme');
        localStorage.setItem('journal-theme', 'light');
        themeToggle.textContent = '🌙 Dark Mode';
      } else {
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('journal-theme', 'dark');
        themeToggle.textContent = '☀️ Light Mode';
      }
    });

    prevBtn.addEventListener('click', goPrev);
    nextBtn.addEventListener('click', goNext);

    const allTextAreas = [entryBox, affirmation, topTasks, gratitude, eveningReflection];
    allTextAreas.forEach(el => {
      el.addEventListener('input', () => {
        saveState();
        autoGrow(el);
      });
    });

    // --- CHANGE 6: ADD EVENT LISTENER TO THE TABLE ---
    dailyScheduleTable.addEventListener('input', saveState);
    // --- CHANGE 6 END ---

    [moodMorning, moodAfternoon, moodEvening].forEach(el => el.addEventListener('change', saveState));
    [habitRead, habitMove, habitWater].forEach(el => el.addEventListener('change', saveState));
    init();

    /* ----------------- BACKUP & RESTORE (No changes needed here, it just works!) ------------------ */
    downloadBackup.addEventListener('click', () => {
      const data = {};
      for (let day = 1; day <= TOTAL_DAYS; day++) {
        data[`day-${day}`] = {
          entry: localStorage.getItem(getStorageKey(day, 'entry')) || '',
          affirmation: localStorage.getItem(getStorageKey(day, 'affirmation')) || '',
          tasks: localStorage.getItem(getStorageKey(day, 'tasks')) || '',
          gratitude: localStorage.getItem(getStorageKey(day, 'gratitude')) || '',
          reflection: localStorage.getItem(getStorageKey(day, 'reflection')) || '',
          schedule: localStorage.getItem(getStorageKey(day, 'schedule')) || '', // This now saves the JSON string
          moodMorning: localStorage.getItem(getStorageKey(day, 'mood-morning')) || '',
          moodAfternoon: localStorage.getItem(getStorageKey(day, 'mood-afternoon')) || '',
          moodEvening: localStorage.getItem(getStorageKey(day, 'mood-evening')) || '',
          habits: {
            read: localStorage.getItem(getStorageKey(day, 'habit-read')) === 'true',
            move: localStorage.getItem(getStorageKey(day, 'habit-move')) === 'true',
            water: localStorage.getItem(getStorageKey(day, 'habit-water')) === 'true'
          }
        };
      }
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `journal-backup-${YEAR}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });

    loadBackup.addEventListener('click', () => uploadBackup.click());

    uploadBackup.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          for (const [dayKey, values] of Object.entries(data)) {
            const day = parseInt(dayKey.replace('day-', ''), 10);
            if (day >= 1 && day <= TOTAL_DAYS) {
              localStorage.setItem(getStorageKey(day, 'entry'), values.entry || '');
              localStorage.setItem(getStorageKey(day, 'affirmation'), values.affirmation || '');
              localStorage.setItem(getStorageKey(day, 'tasks'), values.tasks || '');
              localStorage.setItem(getStorageKey(day, 'gratitude'), values.gratitude || '');
              localStorage.setItem(getStorageKey(day, 'reflection'), values.reflection || '');
              localStorage.setItem(getStorageKey(day, 'schedule'), values.schedule || ''); // This now restores the JSON string
              localStorage.setItem(getStorageKey(day, 'mood-morning'), values.moodMorning || '');
              localStorage.setItem(getStorageKey(day, 'mood-afternoon'), values.moodAfternoon || '');
              localStorage.setItem(getStorageKey(day, 'mood-evening'), values.moodEvening || '');
              if (values.habits) {
                localStorage.setItem(getStorageKey(day, 'habit-read'), values.habits.read);
                localStorage.setItem(getStorageKey(day, 'habit-move'), values.habits.move);
                localStorage.setItem(getStorageKey(day, 'habit-water'), values.habits.water);
              }
            }
          }
          alert('✅ Backup loaded successfully!');
          updatePage();
        } catch (err) {
          alert('❌ Failed to load backup. Invalid file.');
          console.error(err);
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
