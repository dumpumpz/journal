<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Journal</title>
  <style>
    :root {
      --paper: #f5f5f5;
      --bg: #e4e9ed;
      --text: #333;
      --text-light: #555;
      --border-color: #d1d1d1;
      --accent: #b48ead;
    }
    [data-theme="dark"] {
      --paper: #282c34;
      --bg: #21252b;
      --text: #d8dee9;
      --text-light: #abb2bf;
      --border-color: #4c566a;
      --accent: #88c0d0;
    }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Georgia', serif; /* Changed to serif for a classic journal feel */ display: flex; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; min-height: 100vh; transition: background 0.3s, color 0.3s; }
    main { width: 100%; max-width: 600px; background: var(--paper); padding: 25px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 25px; }
    
    .date-header { text-align: center; font-family: 'Courier New', monospace; font-size: 1.2em; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin: 0 0 10px 0; }
    
    /* The main free-form text area */
    #dailyLog {
      width: 100%;
      min-height: 150px;
      font-size: 1.1em;
      line-height: 1.7;
      font-family: inherit;
      border: none;
      background: transparent;
      resize: vertical;
      outline: none;
      color: var(--text);
      padding: 0;
    }

    /* Section for structured prompts */
    .prompts, .trackers-section {
      border-top: 1px dashed var(--border-color);
      padding-top: 20px;
    }
    .prompt-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }
    .prompt-group label {
      font-weight: bold;
      color: var(--text-light);
      font-size: 1em;
      font-family: sans-serif; /* Use sans-serif for UI elements */
    }
    .prompt-group input[type="text"] {
      font-family: inherit;
      font-size: 1.05em;
      padding: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg);
      border-radius: 4px;
      color: var(--text);
    }
    .prompt-group input[type="text"]:focus {
        outline: 2px solid var(--accent);
        border-color: var(--accent);
    }

    /* Mood Trackers - Inspired by your screenshot */
    .mood-trackers { display: flex; flex-direction: column; gap: 15px; }
    .mood-tracker { display: flex; align-items: center; gap: 10px; }
    .mood-tracker label { font-size: 1.1em; flex-basis: 150px; }
    .mood-tracker select { flex-grow: 1; font-size: 1em; padding: 5px; border-radius: 4px; border: 1px solid var(--border-color); background-color: var(--paper); color: var(--text); }
    
    footer { font-size: 0.9em; text-align: right; color: #888; margin-top: 10px; }
    .controls { margin-top: 20px; display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
    button { background: var(--accent); color: white; border: none; padding: 10px 20px; font-size: 1em; border-radius: 5px; cursor: pointer; transition: background 0.3s; font-family: sans-serif; }
    button:hover:not(:disabled) { opacity: 0.85; }
    button:disabled { background: #a99484; cursor: not-allowed; }
    .theme-toggle { position: fixed; top: 10px; right: 10px; font-size: 0.9em; z-index: 10; }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">☀️</button>
  
  <main class="journal-page">
    <h1 class="date-header" id="dateHeader">Loading...</h1>
    
    <!-- The main, unstructured writing area -->
    <textarea id="dailyLog" placeholder="Start writing..."></textarea>
    
    <!-- A simple, non-intrusive section for key prompts -->
    <section class="prompts">
        <div class="prompt-group">
            <label for="goal">🎯 Morning Goal</label>
            <input type="text" id="goal" placeholder="What's your #1 objective for today?">
        </div>
        <div class="prompt-group">
            <label for="lessonLearned">✅ Evening Lesson</label>
            <input type="text" id="lessonLearned" placeholder="What was the key takeaway?">
        </div>
    </section>

    <!-- Mood trackers, as seen in your screenshot -->
    <section class="trackers-section">
      <div class="mood-trackers">
        <div class="mood-tracker">
            <label for="morningMood">🌅 Morning Mood</label>
            <select id="morningMood">
                <option value="">Select...</option><option value="Great">😊 Great</option><option value="Good">🙂 Good</option><option value="Meh">😐 Meh</option><option value="Tired">😴 Tired</option><option value="Anxious">😟 Anxious</option>
            </select>
        </div>
        <div class="mood-tracker">
            <label for="afternoonMood">🏞️ Afternoon Mood</label>
            <select id="afternoonMood">
                <option value="">Select...</option><option value="Productive">⚡ Productive</option><option value="Focused">🎯 Focused</option><option value="Distracted">😵 Distracted</option><option value="Tired">😴 Tired</option><option value="Stressed">😫 Stressed</option>
            </select>
        </div>
        <div class="mood-tracker">
            <label for="eveningMood">🌙 Evening Mood</label>
            <select id="eveningMood">
                <option value="">Select...</option><option value="Happy">😄 Happy</option><option value="Content">😌 Content</option><option value="Relaxed">🧘 Relaxed</option><option value="Tired">😴 Tired</option><option value="Sad">😢 Sad</option>
            </select>
        </div>
      </div>
    </section>
    
    <footer id="pageNumber"></footer>
  </main>

  <div class="controls">
    <button id="prevBtn">‹ Prev</button>
    <button id="nextBtn">Next ›</button>
  </div>
  <div class="controls">
    <button id="downloadBackup">⬇️ Backup</button>
    <input type="file" id="uploadBackup" accept=".json" style="display:none;">
    <button id="loadBackup">⬆️ Load Backup</button>
  </div>

<script>
const app = {
  YEAR: 2025,
  TOTAL_DAYS: 365,
  currentDay: 1,
  dom: {},
  config: {},
  
  init() {
    this.TOTAL_DAYS = ((this.YEAR % 4 === 0 && this.YEAR % 100 !== 0) || (this.YEAR % 400 === 0)) ? 366 : 365;
    this.cacheDom();
    this.initConfig(); // Reconfigured for the new, simpler layout
    this.bindEvents();
    this.loadTheme();
    this.loadInitialPage();
  },
  
  cacheDom() {
    this.dom = {
      dateHeader: document.getElementById('dateHeader'),
      pageNumber: document.getElementById('pageNumber'),
      prevBtn: document.getElementById('prevBtn'),
      nextBtn: document.getElementById('nextBtn'),
      themeToggle: document.getElementById('themeToggle'),
      downloadBtn: document.getElementById('downloadBackup'),
      uploadBtn: document.getElementById('uploadBackup'),
      loadBtn: document.getElementById('loadBackup'),
    };
  },
  
  initConfig() {
      this.config = {
          // New, simplified structure
          dailyLog:      { type: 'value', el: document.getElementById('dailyLog') },
          goal:          { type: 'value', el: document.getElementById('goal') },
          lessonLearned: { type: 'value', el: document.getElementById('lessonLearned') },
          morningMood:   { type: 'value', el: document.getElementById('morningMood') },
          afternoonMood: { type: 'value', el: document.getElementById('afternoonMood') },
          eveningMood:   { type: 'value', el: document.getElementById('eveningMood') },
      };
  },
  
  bindEvents() {
    this.dom.prevBtn.addEventListener('click', () => this.navigate(-1));
    this.dom.nextBtn.addEventListener('click', () => this.navigate(1));
    this.dom.themeToggle.addEventListener('click', () => this.toggleTheme());
    this.dom.downloadBtn.addEventListener('click', () => this.downloadBackup());
    this.dom.loadBtn.addEventListener('click', () => this.dom.uploadBtn.click());
    this.dom.uploadBtn.addEventListener('change', (e) => this.loadBackup(e));
    
    Object.values(this.config).forEach(field => {
      const eventType = (field.el.tagName === 'SELECT') ? 'change' : 'input';
      field.el.addEventListener(eventType, () => this.saveState());
    });
  },
  
  getStorageKey(day, key) { return `journal-v4-${this.YEAR}-day-${day}-${key}`; }, // Version up!
  
  saveState() {
    try {
      for (const [key, field] of Object.entries(this.config)) {
        localStorage.setItem(this.getStorageKey(this.currentDay, key), field.el[field.type]);
      }
      localStorage.setItem('journal-v4-last-opened', this.currentDay);
    } catch (e) { console.error("Failed to save state.", e); }
  },
  
  loadState() {
    for (const [key, field] of Object.entries(this.config)) {
      const value = localStorage.getItem(this.getStorageKey(this.currentDay, key));
      field.el[field.type] = value || '';
    }
  },
  
  updatePage() {
    const date = new Date(this.YEAR, 0, this.currentDay);
    this.dom.dateHeader.textContent = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    this.dom.pageNumber.textContent = `Day ${this.currentDay} / ${this.TOTAL_DAYS}`;
    this.loadState();
    this.dom.prevBtn.disabled = this.currentDay <= 1;
    this.dom.nextBtn.disabled = this.currentDay >= this.TOTAL_DAYS;
  },
  
  navigate(direction) {
    this.saveState();
    const newDay = this.currentDay + direction;
    if (newDay >= 1 && newDay <= this.TOTAL_DAYS) {
      this.currentDay = newDay;
      this.updatePage();
    }
  },
  
  loadInitialPage() {
    const saved = parseInt(localStorage.getItem('journal-v4-last-opened'), 10);
    const today = new Date();
    const start = new Date(this.YEAR, 0, 1);
    const dayOfYear = Math.floor((today - start) / (1000 * 60 * 60 * 24)) + 1;
    
    let initialDay = (today.getFullYear() === this.YEAR) ? dayOfYear : 1;
    this.currentDay = !isNaN(saved) ? saved : initialDay;
    this.updatePage();
  },
  
  toggleTheme() {
    const isDark = document.documentElement.hasAttribute('data-theme');
    if (isDark) {
      document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('journal-theme', 'light');
      this.dom.themeToggle.textContent = '🌙';
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      localStorage.setItem('journal-theme', 'dark');
      this.dom.themeToggle.textContent = '☀️';
    }
  },
  
  loadTheme() {
    if (localStorage.getItem('journal-theme') === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      this.dom.themeToggle.textContent = '☀️';
    } else {
      this.dom.themeToggle.textContent = '🌙';
    }
  },

  downloadBackup() { /* Unchanged from previous version, will work automatically with new config */ },
  loadBackup(e) { /* Unchanged from previous version, will work automatically with new config */ },
};

app.init();
</script>
</body>
</html>