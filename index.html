<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"/>
  <title>My Journal</title>
  <style>
    /* Layout Lockdown */
    html { box-sizing: border-box; }
    *, *:before, *:after { box-sizing: inherit; }
    html, body { overflow-x: hidden; }

    /* Color Schemes are unchanged */
    :root {
      --paper: #FBF6EF; --bg: #F0EADE; --text: #4a4a4a; --text-light: #7a7a7a; --border-color: #dcd6cc; --accent: #8A9A5B; --shadow: rgba(0,0,0,0.08);
    }
    [data-theme="dark"] {
      --paper: #1c1c1c; --bg: #000000; --text: #e2e2e2; --text-light: #9e9e9e; --border-color: #3a3a3a; --accent: #4682B4; --shadow: rgba(0,0,0,0.4);
    }

    /* --- Body and Layout --- */
    body { 
      margin: 0; 
      background: var(--bg); 
      color: var(--text); 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      padding: 20px; 
      min-height: 100vh; 
    }

    /* --- Tab Navigation --- */
    .tab-navigation {
      display: flex;
      gap: 5px;
      margin-bottom: -1px; /* Overlap border with main content */
      max-width: 600px;
      width: 100%;
      z-index: 2;
    }
    .tab-button {
      padding: 10px 20px;
      border: 1px solid var(--border-color);
      border-bottom: none;
      background: var(--bg);
      color: var(--text-light);
      cursor: pointer;
      border-radius: 6px 6px 0 0;
      font-size: 1em;
      font-family: inherit;
    }
    .tab-button.active {
      background: var(--paper);
      color: var(--text);
      font-weight: bold;
      border-bottom: 1px solid var(--paper); /* Hides the top border of the content pane */
    }

    /* --- Main content container --- */
    .tab-content { 
      width: 100%; 
      max-width: 600px; 
      background: var(--paper); 
      padding: 25px; 
      border-radius: 8px;
      border-top-left-radius: 0; /* Adjust for tabs */
      box-shadow: 0 4px 20px var(--shadow); 
      flex-direction: column; 
      gap: 20px; 
      transition: opacity 0.2s ease-in-out; 
      display: none; /* Hide all tab content by default */
    }
    .tab-content.active {
      display: flex; /* Show the active one */
    }
    .journal-page--loading { opacity: 0; }

    .date-header { text-align: center; font-family: 'Courier New', monospace; font-size: 1.2em; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin: 0; }
    
    /* --- Grouped styles for textareas --- */
    #dailyLog, #globalNotes { 
      width: 100%; 
      min-height: 150px; 
      font-size: 1.1em; 
      line-height: 1.7; 
      font-family: inherit; 
      border: none; 
      background: transparent; 
      resize: vertical; 
      outline: none; 
      color: var(--text); 
      padding: 0; 
      overflow-y: hidden; 
    }

    .prompts, .trackers-section { border-top: 1px dashed var(--border-color); padding-top: 20px; }
    .prompt-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
    .prompt-group label { font-weight: bold; color: var(--text-light); font-size: 1em; }

    .prompt-group textarea {
      font-family: inherit; font-size: 1.05em; line-height: 1.6; padding: 8px; border: 1px solid var(--border-color);
      background: var(--bg); border-radius: 4px; color: var(--text); resize: none; overflow-y: hidden;
    }
    .prompt-group textarea:focus { outline: 2px solid var(--accent); border-color: var(--accent); }

    .mood-trackers { display: flex; flex-direction: column; gap: 15px; }
    .mood-tracker { display: flex; align-items: center; gap: 10px; }
    .mood-tracker .label-container { flex-basis: 160px; font-size: 1.1em; display: flex; align-items: center; gap: 8px;}
    .mood-emoji { font-size: 1.2em; display: inline-block; width: 24px; text-align: center;}
    .mood-tracker select { flex-grow: 1; font-size: 1em; padding: 5px; border-radius: 4px; border: 1px solid var(--border-color); background-color: var(--paper); color: var(--text); font-family: inherit; }
    
    /* --- NEW: Energy Slider Styles --- */
    .energy-slider {
      flex-grow: 1;
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: var(--bg);
      outline: none;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .energy-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--accent);
      cursor: pointer;
      border-radius: 50%;
    }
    .energy-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--accent);
      cursor: pointer;
      border-radius: 50%;
      border: none;
    }
    .energy-value {
      font-family: 'Courier New', monospace;
      font-size: 1.2em;
      font-weight: bold;
      min-width: 20px;
      text-align: center;
      color: var(--text-light);
    }
    
    footer { font-size: 0.9em; text-align: right; color: #888; margin-top: 10px; }
    .controls { margin-top: 20px; display: flex; gap: 16px; justify-content: center; align-items: center; }
    button { background: var(--accent); color: white; border: none; padding: 10px 20px; font-size: 1em; border-radius: 5px; cursor: pointer; transition: background 0.3s, opacity 0.3s; font-family: inherit; }
    button:hover:not(:disabled) { opacity: 0.85; }
    button:disabled { background: #999; opacity: 0.7; cursor: not-allowed; }
    [data-theme="dark"] button:disabled { background: #555; }
    .theme-toggle { position: fixed; top: 10px; right: 10px; font-size: 0.9em; z-index: 10; }
    .settings-btn { background: transparent; border: 1px solid var(--border-color); color: var(--text-light); padding: 8px; line-height: 1; font-size: 1.2em; }
    .settings-btn:hover { background: var(--bg); color: var(--text); }
    .settings-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    .settings-menu { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 300px; background: var(--paper); padding: 20px; border-radius: 8px; z-index: 101; opacity: 0; pointer-events: none; transition: opacity 0.3s ease, transform 0.3s ease; display: flex; flex-direction: column; gap: 15px; }
    .settings-menu.is-open, .settings-backdrop.is-open { opacity: 1; pointer-events: auto; }
    .settings-menu .menu-title { margin: 0; text-align: center; }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">‚òÄÔ∏è</button>

  <div class="tab-navigation">
    <button id="dailyTabBtn" class="tab-button active">Daily</button>
    <button id="globalTabBtn" class="tab-button">Notes</button>
  </div>

  <main id="dailyView" class="tab-content active">
    <h1 class="date-header" id="dateHeader">Loading...</h1>

    <textarea id="dailyLog" placeholder="Start writing..."></textarea>

    <section class="prompts">
        <div class="prompt-group">
            <label for="goal">üéØ Morning Goal</label>
            <textarea id="goal" rows="1" placeholder="What's your #1 objective for today?"></textarea>
        </div>
        <div class="prompt-group">
            <label for="eveningNote">üìù End-of-Day Thoughts</label>
            <textarea id="eveningNote" rows="1" placeholder="A note on how the day went..."></textarea>
        </div>
    </section>

    <section class="trackers-section">
      <div class="mood-trackers">
        <div class="mood-tracker">
            <div class="label-container"><span class="mood-emoji" id="morningMoodEmoji"></span><label for="morningMood">Morning</label></div>
            <select id="morningMood">
                <option value="" data-emoji="">Select...</option><option value="Great" data-emoji="üòä">Great</option><option value="Good" data-emoji="üôÇ">Good</option><option value="Meh" data-emoji="üòê">Meh</option><option value="Tired" data-emoji="üò¥">Tired</option><option value="Anxious" data-emoji="üòü">Anxious</option>
            </select>
        </div>
        <div class="mood-tracker">
            <div class="label-container"><span class="mood-emoji" id="afternoonMoodEmoji"></span><label for="afternoonMood">Afternoon</label></div>
            <select id="afternoonMood">
                <option value="" data-emoji="">Select...</option><option value="Productive" data-emoji="‚ö°">Productive</option><option value="Focused" data-emoji="üéØ">Focused</option><option value="Distracted" data-emoji="üòµ">Distracted</option><option value="Tired" data-emoji="üò¥">Tired</option><option value="Stressed" data-emoji="üò´">Stressed</option>
            </select>
        </div>
        <div class="mood-tracker">
            <div class="label-container"><span class="mood-emoji" id="eveningMoodEmoji"></span><label for="eveningMood">Evening</label></div>
            <select id="eveningMood">
                <option value="" data-emoji="">Select...</option><option value="Happy" data-emoji="üòÑ">Happy</option><option value="Content" data-emoji="üòå">Content</option><option value="Relaxed" data-emoji="üßò">Relaxed</option><option value="Tired" data-emoji="üò¥">Tired</option><option value="Sad" data-emoji="üò¢">Sad</option>
            </select>
        </div>
      </div>

      <!-- NEW: Energy Tracker Section -->
      <div class="energy-tracker-container" style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--border-color);">
        <div class="prompt-group" style="margin-bottom: 10px; gap: 4px;">
            <label style="font-size: 1.1em; color: var(--text); font-weight: bold;">üå°Ô∏è Track Energy, Not Just Mood</label>
            <p style="font-size: 0.9em; line-height: 1.5; color: var(--text-light); margin: 0;">A big piece of this is probably low energy + emotional fatigue. You may be burning out on ideas, effort, even self-pressure. Add a simple energy slider (1‚Äì5), morning and evening. Start seeing what affects your energy, not just your emotions.</p>
        </div>
        <div class="mood-trackers">
          <div class="mood-tracker">
              <div class="label-container"><span class="mood-emoji">üåÖ</span><label for="morningEnergy">Morning Energy</label></div>
              <input type="range" id="morningEnergy" min="1" max="5" value="3" class="energy-slider">
              <span class="energy-value" id="morningEnergyValue">3</span>
          </div>
          <div class="mood-tracker">
              <div class="label-container"><span class="mood-emoji">üåÉ</span><label for="eveningEnergy">Evening Energy</label></div>
              <input type="range" id="eveningEnergy" min="1" max="5" value="3" class="energy-slider">
              <span class="energy-value" id="eveningEnergyValue">3</span>
          </div>
        </div>
      </div>
      <!-- End of Energy Tracker Section -->
      
    </section>
    <footer id="pageNumber"></footer>
  </main>

  <main id="globalView" class="tab-content">
    <h1 class="date-header">Global Notes</h1>
    <textarea id="globalNotes" placeholder="Notes that persist across all days..."></textarea>
  </main>

  <div class="controls">
    <button id="prevBtn">‚Äπ Prev</button>
    <button id="nextBtn">Next ‚Ä∫</button>
    <button id="settingsBtn" class="settings-btn" aria-label="Settings">‚öôÔ∏è</button>
  </div>

  <div class="settings-backdrop" id="settingsBackdrop"></div>
  <div class="settings-menu" id="settingsMenu">
    <h3 class="menu-title">Data Management</h3>
    <button id="downloadBackup">‚¨áÔ∏è Download Backup</button>
    <button id="loadBackup">‚¨ÜÔ∏è Load from Backup</button>
    <input type="file" id="uploadBackup" accept=".json" style="display:none;">
  </div>
   <p style="font-size: 0.8em; color: #888; text-align: center; max-width: 600px;">
    Your journal is saved in this browser's local storage.
    Please use the <strong>Backup ‚öôÔ∏è</strong> button regularly to prevent data loss.
  </p>

<script>
// --- The JavaScript has been updated to support the new Energy Sliders ---
const app = {
  YEAR: 2025,
  currentDay: 1,
  dom: {},
  config: {},

  init() {
    this.TOTAL_DAYS = ((this.YEAR % 4 === 0 && this.YEAR % 100 !== 0) || (this.YEAR % 400 === 0)) ? 366 : 365;
    this.cacheDom();
    this.initConfig();
    this.bindEvents();
    this.loadTheme();
    this.loadGlobalNotes();
    this.autoGrow(this.dom.globalNotes);
    this.loadInitialPage();
  },

  cacheDom() {
    this.dom = {
      // Tab elements
      dailyTabBtn: document.getElementById('dailyTabBtn'),
      globalTabBtn: document.getElementById('globalTabBtn'),
      dailyView: document.getElementById('dailyView'),
      globalView: document.getElementById('globalView'),
      globalNotes: document.getElementById('globalNotes'),
      // Daily view elements
      dateHeader: document.getElementById('dateHeader'),
      pageNumber: document.getElementById('pageNumber'),
      textareas: document.querySelectorAll('#dailyView textarea'),
      moodSelectors: document.querySelectorAll('.mood-tracker select'),
      energySliders: document.querySelectorAll('.energy-slider'), // NEW
      // Controls
      controls: document.querySelector('.controls'),
      prevBtn: document.getElementById('prevBtn'),
      nextBtn: document.getElementById('nextBtn'),
      // Theme & Settings
      themeToggle: document.getElementById('themeToggle'),
      settingsBtn: document.getElementById('settingsBtn'),
      settingsMenu: document.getElementById('settingsMenu'),
      settingsBackdrop: document.getElementById('settingsBackdrop'),
      downloadBtn: document.getElementById('downloadBackup'),
      uploadBtn: document.getElementById('uploadBackup'),
      loadBtn: document.getElementById('loadBackup'),
    };
  },

  initConfig() {
    this.config = {
      dailyLog: { type: 'value', el: document.getElementById('dailyLog') },
      goal: { type: 'value', el: document.getElementById('goal') },
      eveningNote: { type: 'value', el: document.getElementById('eveningNote') },
      morningMood: { type: 'value', el: document.getElementById('morningMood') },
      afternoonMood: { type: 'value', el: document.getElementById('afternoonMood') },
      eveningMood: { type: 'value', el: document.getElementById('eveningMood') },
      morningEnergy: { type: 'value', el: document.getElementById('morningEnergy') }, // NEW
      eveningEnergy: { type: 'value', el: document.getElementById('eveningEnergy') }, // NEW
    };
  },

  bindEvents() {
    // Tab switching
    this.dom.dailyTabBtn.addEventListener('click', () => this.switchTab('daily'));
    this.dom.globalTabBtn.addEventListener('click', () => this.switchTab('global'));

    // Navigation
    this.dom.prevBtn.addEventListener('click', () => this.navigate(-1));
    this.dom.nextBtn.addEventListener('click', () => this.navigate(1));

    // Theming and Settings
    this.dom.themeToggle.addEventListener('click', () => this.toggleTheme());
    this.dom.settingsBtn.addEventListener('click', () => this.openSettings());
    this.dom.settingsBackdrop.addEventListener('click', () => this.closeSettings());
    
    // Data saving for daily view
    this.dom.dailyView.addEventListener('input', (e) => {
      if (e.target.id && this.config[e.target.id]) {
        this.saveState();
        if (e.target.tagName === 'TEXTAREA') this.autoGrow(e.target);
        if (e.target.classList.contains('energy-slider')) { // NEW
            this.updateEnergyValueDisplay(e.target);
        }
      }
    });
    this.dom.dailyView.addEventListener('change', (e) => {
      if (e.target.tagName === 'SELECT') {
        this.saveState();
        this.updateMoodEmoji(e.target);
      }
    });

    // Data saving for global view
    this.dom.globalNotes.addEventListener('input', (e) => {
      this.saveGlobalNotes();
      this.autoGrow(e.target);
    });

    // Backup/Restore
    this.dom.downloadBtn.addEventListener('click', () => this.downloadBackup());
    this.dom.loadBtn.addEventListener('click', () => this.dom.uploadBtn.click());
    this.dom.uploadBtn.addEventListener('change', (e) => this.loadBackup(e));
  },
  
  switchTab(tabId) {
    const isDaily = tabId === 'daily';
    this.dom.dailyTabBtn.classList.toggle('active', isDaily);
    this.dom.globalTabBtn.classList.toggle('active', !isDaily);
    this.dom.dailyView.classList.toggle('active', isDaily);
    this.dom.globalView.classList.toggle('active', !isDaily);
    this.dom.controls.style.display = isDaily ? 'flex' : 'none';
  },

  openSettings() { this.dom.settingsMenu.classList.add('is-open'); this.dom.settingsBackdrop.classList.add('is-open'); },
  closeSettings() { this.dom.settingsMenu.classList.remove('is-open'); this.dom.settingsBackdrop.classList.remove('is-open'); },

  // --- Daily Data Functions ---
  getStorageKey(day, key) { return `journal-v6-${this.YEAR}-day-${day}-${key}`; },
  saveState() {
    try {
      for (const [key, field] of Object.entries(this.config)) {
        // For sliders, ensure a default value is saved if one hasn't been loaded yet.
        const value = field.el[field.type] || (field.el.type === 'range' ? '3' : '');
        localStorage.setItem(this.getStorageKey(this.currentDay, key), value);
      }
      localStorage.setItem('journal-v6-last-opened', this.currentDay);
    } catch (e) { console.error("Failed to save state.", e); }
  },
  loadState() {
    for (const [key, field] of Object.entries(this.config)) {
      const value = localStorage.getItem(this.getStorageKey(this.currentDay, key));
      // For sliders, provide a default value if nothing is stored.
      if(field.el.type === 'range') {
        field.el[field.type] = value || '3';
      } else {
        field.el[field.type] = value || (field.type === 'checked' ? false : '');
      }
    }
  },

  // --- Global Data Functions ---
  getGlobalStorageKey() { return `journal-v6-${this.YEAR}-global-notes`; },
  saveGlobalNotes() {
      localStorage.setItem(this.getGlobalStorageKey(), this.dom.globalNotes.value);
  },
  loadGlobalNotes() {
      this.dom.globalNotes.value = localStorage.getItem(this.getGlobalStorageKey()) || '';
  },

  updatePageUI() {
    this.dom.dateHeader.textContent = new Date(this.YEAR, 0, this.currentDay).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
    this.dom.pageNumber.textContent = `Day ${this.currentDay} / ${this.TOTAL_DAYS}`;
    this.loadState();
    this.dom.textareas.forEach(el => this.autoGrow(el));
    this.dom.moodSelectors.forEach(el => this.updateMoodEmoji(el));
    this.dom.energySliders.forEach(el => this.updateEnergyValueDisplay(el)); // NEW
    this.dom.prevBtn.disabled = this.currentDay <= 1;
    this.dom.nextBtn.disabled = this.currentDay >= this.TOTAL_DAYS;
  },

  navigate(direction) {
    if ((direction === -1 && this.currentDay <= 1) || (direction === 1 && this.currentDay >= this.TOTAL_DAYS)) return;
    this.saveState();
    this.dom.dailyView.classList.add('journal-page--loading');
    setTimeout(() => {
      this.currentDay += direction;
      this.updatePageUI();
      this.dom.dailyView.classList.remove('journal-page--loading');
    }, 200);
  },

  loadInitialPage() {
    const saved = parseInt(localStorage.getItem('journal-v6-last-opened'), 10);
    const today = new Date();
    const start = new Date(this.YEAR, 0, 1);
    const dayOfYear = Math.floor((today - start) / (1000 * 60 * 60 * 24)) + 1;
    let initialDay = (today.getFullYear() === this.YEAR) ? dayOfYear : 1;
    this.currentDay = !isNaN(saved) ? saved : initialDay;
    this.updatePageUI();
  },

  autoGrow(element) { if (!element) return; element.style.height = 'auto'; element.style.height = (element.scrollHeight) + 'px'; },
  
  updateMoodEmoji(selectElement) {
    const emojiSpan = document.getElementById(`${selectElement.id}Emoji`);
    if (!emojiSpan) return;
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    emojiSpan.textContent = selectedOption.dataset.emoji || '';
  },

  // NEW: Function to update the number next to the energy slider
  updateEnergyValueDisplay(sliderElement) {
    const valueSpan = document.getElementById(`${sliderElement.id}Value`);
    if (valueSpan) {
        valueSpan.textContent = sliderElement.value;
    }
  },

  toggleTheme() {
    const isDark = document.documentElement.hasAttribute('data-theme');
    if (isDark) {
      document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('journal-theme', 'light');
      this.dom.themeToggle.textContent = 'üåô';
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
      localStorage.setItem('journal-theme', 'dark');
      this.dom.themeToggle.textContent = '‚òÄÔ∏è';
    }
  },
  loadTheme() {
    if (localStorage.getItem('journal-theme') === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      this.dom.themeToggle.textContent = '‚òÄÔ∏è';
    } else {
      this.dom.themeToggle.textContent = 'üåô';
    }
  },

  downloadBackup() {
    const data = {};
    const globalNotesContent = localStorage.getItem(this.getGlobalStorageKey());
    if (globalNotesContent) {
        data.globalNotes = globalNotesContent;
    }
    for (let i = 1; i <= this.TOTAL_DAYS; i++) {
      const dayData = {};
      let hasData = false;
      for (const key of Object.keys(this.config)) {
        const value = localStorage.getItem(this.getStorageKey(i, key));
        if (value !== null && value !== '') {
          dayData[key] = value;
          hasData = true;
        }
      }
      if (hasData) data[`day-${i}`] = dayData;
    }
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `journal-backup-${this.YEAR}.json`;
    a.click();
    URL.revokeObjectURL(url);
    this.closeSettings();
  },

  loadBackup(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const data = JSON.parse(event.target.result);
        if (!confirm('This will overwrite existing data. Are you sure?')) {
          e.target.value = '';
          return;
        }
        if (data.globalNotes) {
            localStorage.setItem(this.getGlobalStorageKey(), data.globalNotes);
            this.dom.globalNotes.value = data.globalNotes;
            this.autoGrow(this.dom.globalNotes);
        } else {
            localStorage.removeItem(this.getGlobalStorageKey());
            this.dom.globalNotes.value = '';
        }
        for (const [dayKey, dayData] of Object.entries(data)) {
          if (dayKey.startsWith('day-')) {
             const day = dayKey.split('-')[1];
             for (const [fieldKey, value] of Object.entries(dayData)) {
               if (this.config[fieldKey]) localStorage.setItem(this.getStorageKey(day, fieldKey), value);
             }
          }
        }
        alert('Backup loaded successfully!');
        this.updatePageUI();
        this.closeSettings();
      } catch (error) {
        alert('Failed to load backup file. It might be corrupted.');
        console.error(error);
      } finally {
        e.target.value = '';
      }
    };
    reader.readAsText(file);
  }
};

app.init();
</script>
</body>
</html>
